// NovaCart E-Commerce Platform - Prisma Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  role      UserRole @default(CUSTOMER)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  addresses  Address[]
  orders     Order[]
  cart       Cart?
  wishlist   Wishlist?
  reviews    Review[]

  @@map("users")
}

enum UserRole {
  CUSTOMER
  ADMIN
  SELLER
}

// Address Management
model Address {
  id         String  @id @default(uuid())
  userId     String
  fullName   String
  phone      String
  street     String
  city       String
  state      String
  zipCode    String
  country    String  @default("India")
  isDefault  Boolean @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders Order[]

  @@map("addresses")
}

// Category Management
model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  slug        String   @unique
  description String?
  image       String?
  parentId    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")
  products Product[]

  @@map("categories")
}

// Product Management
model Product {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String   @db.Text
  shortDescription String?
  price       Float
  salePrice   Float?
  stock       Int      @default(0)
  sku         String   @unique
  brand       String?
  categoryId  String
  images      String[]
  thumbnail   String
  rating      Float    @default(0)
  reviewCount Int      @default(0)
  isActive    Boolean  @default(true)
  isFeatured  Boolean  @default(false)

  // New product attributes
  weight      Float?   // in kg
  dimensions  String?  // LxWxH in cm
  color       String?
  material    String?
  warranty    String?

  // Size/Variant support
  hasVariants Boolean  @default(false)
  sizes       String[] // e.g., ["S", "M", "L", "XL"] or ["250ml", "500ml", "1L"]
  colors      String[] // Available colors

  // Additional details
  tags        String[]
  metaTitle   String?
  metaDescription String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  category      Category       @relation(fields: [categoryId], references: [id])
  variants      ProductVariant[]
  cartItems     CartItem[]
  wishlistItems WishlistItem[]
  orderItems    OrderItem[]
  reviews       Review[]

  @@map("products")
}

// Product Variants (for size, color, capacity variations)
model ProductVariant {
  id        String   @id @default(uuid())
  productId String
  sku       String   @unique
  name      String   // e.g., "Red - Large" or "500ml"

  // Variant attributes
  size      String?  // S, M, L, XL, etc.
  color     String?
  capacity  String?  // 250ml, 500ml, 1L, etc.

  // Pricing and stock for this variant
  price     Float?
  salePrice Float?
  stock     Int      @default(0)

  // Optional additional image
  image     String?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  cartItems CartItem[]
  orderItems OrderItem[]

  @@map("product_variants")
}

// Shopping Cart
model Cart {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items CartItem[]

  @@map("carts")
}

model CartItem {
  id        String   @id @default(uuid())
  cartId    String
  productId String
  variantId String?  // Optional variant
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cart    Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([cartId, productId, variantId])
  @@map("cart_items")
}

// Wishlist
model Wishlist {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items WishlistItem[]

  @@map("wishlists")
}

model WishlistItem {
  id         String   @id @default(uuid())
  wishlistId String
  productId  String
  createdAt  DateTime @default(now())

  wishlist Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id])

  @@unique([wishlistId, productId])
  @@map("wishlist_items")
}

// Order Management
model Order {
  id              String      @id @default(uuid())
  userId          String
  orderNumber     String      @unique
  status          OrderStatus @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  subtotal        Float
  tax             Float       @default(0)
  shipping        Float       @default(0)
  discount        Float       @default(0)
  total           Float
  shippingAddressId String
  notes           String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id])
  shippingAddress Address     @relation(fields: [shippingAddressId], references: [id])
  items           OrderItem[]

  @@map("orders")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

model OrderItem {
  id        String   @id @default(uuid())
  orderId   String
  productId String
  variantId String?  // Optional variant
  quantity  Int
  price     Float
  variantName String?  // Store variant name at time of order
  createdAt DateTime @default(now())

  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
}

// Product Reviews
model Review {
  id        String   @id @default(uuid())
  userId    String
  productId String
  rating    Int      // 1-5
  title     String?
  comment   String?
  images    String[]
  isVerified Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("reviews")
}
